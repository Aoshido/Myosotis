{{ form_start(quizForm,{ 'attr': {'class': 'form-horizontal' , 'id' : 'quiz_form_ajax'} }) }}
{% for pregunta in quizForm.preguntas %}
    <div class="panel panel-primary">

        <div class="panel-heading">Pregunta: {{pregunta.vars.value.id}}
            {% for tema in pregunta.vars.value.getTemas %}
                &nbsp;<span class="badge">{{tema.getDescripcion}}</span>&nbsp;
            {% endfor %}
        </div>

        <div class="panel-body quiz_bg loading text-center" id="loading" style="display:none;">
            <h2>Cambiando Pregunta...</h2>
            <h2><i class="fa fa-cog fa-spin fa-2x"></i></h2>
        </div>


        <div class="panel-body quiz_bg" id="newBody" >
            <blockquote>
                <div style="height:150px;overflow:auto; text-overflow-multiline:ellipsis;">
                    {{ pregunta.vars.value.contenido|markdown }}
                    {{ form_widget(pregunta.contenido) }}
                    {{ form_widget(pregunta.id) }}
                </div>
            </blockquote>

            {% for respuesta in pregunta.respuestas %}
                <div class="col-xs-12" style="padding:0;">
                    <div class="col-xs-2 text-right " style="padding:0;"> 
                        {{ form_widget(respuesta.elegida,{ 'attr' : { 'data-on-text' : 'V' , 'data-off-text' : 'F', 'replace' : 'yes' , 'data-size' : 'small'  } }) }}
                    </div>
                    <div class="col-xs-10 text-left" style="padding-right:0 ; overflow:auto; text-overflow-multiline:ellipsis; {%if respuesta.vars.value.contenido|length >= 150%}height:150px;{%endif%}">
                        {{ respuesta.vars.value.contenido|markdown }}
                        {{ form_widget(respuesta.contenido) }}
                        {{ form_widget(respuesta.id) }}
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="panel panel-footer container-fluid" style="padding: 0; margin:0;">

            <div class="col-xs-2" style="padding: 0;">
                <div id="barra2" class="center-block text-right" style ="padding-top: 5%; ">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="-2 -1 42 42" style="max-width: 120px">
                        <path fill-opacity="0" stroke-width="1" stroke="#bbb" d="M 10.0107,39.0535 C 8.0927139,38.92517 5.9822053,38.337159 4.85338,36.6592 5.1822895,31.473484 6.0915318,25.778099 10.003886,22.003739 c 2.71587,-3.008117 6.27305,-5.12009 10.09069,-6.41333 3.230497,-1.120181 6.381864,-2.482311 9.233666,-4.390459 0.887933,-0.562007 2.434702,-1.5837221 2.867808,-1.9618053 -3.703234,1.9987263 -7.617793,3.6392523 -11.743033,4.5245803 -6.879194,1.79858 -13.339879,6.39582 -16.0204699,13.156317 -0.9352635,1.5582 -0.8847742,4.848531 -1.8828122,5.479146 C 0.16224651,30.881946 0.26671867,27.738843 0.45311284,25.24957 0.89346848,19.257586 4.3468258,13.526107 9.6683567,10.648051 15.45406,7.2390015 22.279572,6.5690208 28.820743,5.8571903 32.792319,5.5308631 36.731262,3.4982988 38.7831,0 37.534226,8.9455616 34.855699,17.833743 30.046303,25.533672 26.207096,31.688991 20.324069,36.91901 13.102522,38.530907 12.08423,38.769771 11.050708,38.942911 10.0107,39.0535 Z"/>
                        <path id="leaf-path2" fill-opacity="0" stroke-width="1.5" stroke="#00a65a" d="M 10.0107,39.0535 C 8.0927139,38.92517 5.9822053,38.337159 4.85338,36.6592 5.1822895,31.473484 6.0915318,25.778099 10.003886,22.003739 c 2.71587,-3.008117 6.27305,-5.12009 10.09069,-6.41333 3.230497,-1.120181 6.381864,-2.482311 9.233666,-4.390459 0.887933,-0.562007 2.434702,-1.5837221 2.867808,-1.9618053 -3.703234,1.9987263 -7.617793,3.6392523 -11.743033,4.5245803 -6.879194,1.79858 -13.339879,6.39582 -16.0204699,13.156317 -0.9352635,1.5582 -0.8847742,4.848531 -1.8828122,5.479146 C 0.16224651,30.881946 0.26671867,27.738843 0.45311284,25.24957 0.89346848,19.257586 4.3468258,13.526107 9.6683567,10.648051 15.45406,7.2390015 22.279572,6.5690208 28.820743,5.8571903 32.792319,5.5308631 36.731262,3.4982988 38.7831,0 37.534226,8.9455616 34.855699,17.833743 30.046303,25.533672 26.207096,31.688991 20.324069,36.91901 13.102522,38.530907 12.08423,38.769771 11.050708,38.942911 10.0107,39.0535 Z"/>
                    </svg>
                </div>
            </div>
            <div class="col-xs-10">
                <table class="table table-condensed" style="margin-top: 1%; margin-bottom: 0;">
                    <tr>
                        <td class="col-xs-12" style ="border-top: none !important;">
                            <div class="progress progress-striped active" style="margin:0">
                                <div class="progress-bar progress-bar-warning" style="width: 0%"></div>
                                <span class="progress-type">Combo</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-xs-12" style ="border-top: none !important;">
                            <div class="progress progress-xs progress-striped active" style="margin:0">
                                <div class="progress-bar progress-bar-success" style="width: {{ app.user.level }}%"></div>
                                <span class="progress-type">Nivel: {{ app.user.level }}</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-xs-12" style ="border-top: none !important;">
                            {% set expPercentage =  (app.user.currentExperience / (2**app.user.level)*100)|round %}
                            <div class="progress progress-xxs progress-striped active" style=" margin:0">
                                <div class="progress-bar progress-bar-success" style="width: {{expPercentage}}%"></div>
                                <span class="progress-type">Exp: {{ app.user.currentExperience }} de {{ (2**app.user.level) }} Puntos</span>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
{% endfor %}
<div class="col-sm-12 text-center">
    {{ form_widget(quizForm.save) }}
</div>
<input type="hidden" value={{correctas}} name="correctas" />
<input type="hidden" value={{incorrectas}} name="incorrectas" />
{{ form_row(quizForm._token) }}
{{ form_end(quizForm, {'render_rest': false}) }}


{% if app.user %}
    {% set expPercentage =  (app.user.currentExperience / (2**app.user.level)) %}
{% else %}
    {% set expPercentage = 0 %}
{% endif %}

<script>
    var bar = new ProgressBar.Path('#leaf-path2', {
        color: '#00a65a',
        strokeWidth: 1,
        trailWidth: 1,
        easing: 'easeInOut',
        duration: 1400,
        text: {
            autoStyleContainer: false
        },
        from: {color: '#00a65a', width: 1},
        to: {color: '#ffcc00', width: 1},
        // Set default step function for all animate calls
        step: function (state, circle) {
            circle.path.setAttribute('stroke', state.color);
            circle.path.setAttribute('stroke-width', state.width);
        }
    });

    bar.set(0);
    bar.animate({{expPercentage}});  // Number from 0.0 to 1.0
</script>


<script>
    // Variable to hold request
    var request;

    // Bind to the submit event of our form
    $("#quiz_form_ajax").submit(function (event) {

        // Abort any pending request
        if (request) {
            request.abort();
        }
        // setup some local variables
        var $form = $(this);

        // Let's select and cache all the fields
        var $inputs = $form.find("input, select, button, textarea");

        // Serialize the data in the form
        var serializedData = $form.serialize();

        // Let's disable the inputs for the duration of the Ajax request.
        // Note: we disable elements AFTER the form data has been serialized.
        // Disabled form elements will not be serialized.
        $inputs.prop("disabled", true);

        // Fire off the request to /form.php
        request = $.ajax({
            url: "{{path('games_challenge_new')}}",
            type: "post",
            data: serializedData
        });

        $('#loading').show();
        $("#newBody").hide();

        // Callback handler that will be called on success
        request.done(function (response, textStatus, jqXHR) {
            // Log a message to the console
            console.log("Hooray, it worked!");

            $("#reemplazo").html(response);
            $("#newBody").show();
            $('#loading').hide();
        });

        // Callback handler that will be called on failure
        request.fail(function (jqXHR, textStatus, errorThrown) {
            // Log the error to the console
            console.error(
                    "The following error occurred: " +
                    textStatus, errorThrown
                    );
        });

        // Callback handler that will be called regardless
        // if the request failed or succeeded
        request.always(function () {
            // Reenable the inputs
            $inputs.prop("disabled", false);
        });

        // Prevent default posting of form
        event.preventDefault();
    });
</script>

<script type="text/javascript">
    $("[replace='yes']").bootstrapSwitch();
</script>

{% include 'AoshidowebBundle::flash.html.twig' %}